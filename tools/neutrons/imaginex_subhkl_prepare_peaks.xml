<tool id="imaginex_subhkl_prepare_peaks" name="IMAGINE-X HKL Prepare Peaks"  profile="22.05" version="0.1.0-dev" python_template_version="3.5">
  <requirements>
    <container type="docker">ghcr.io/zjmorgan/subhkl:main</container>
  </requirements>
    <command detect_errors="exit_code"><![CDATA[

		mkdir out ; 
		
		#for $input_file in $input
			mv $input_file $input_file.element_identifier ;
		#end for
		
		#import csv
		#manifest_file = open($manifest)
		#for row in csv.DictReader(manifest_file)
			#set $col1 = row[0]
			#set $col2 = row[1]
			#set $col3 = row[2]
			#set $col4 = row[3]
			#set $col5 = row[4]
			#set $col6 = row[5]
			#set $col7 = row[6]
			#set $col8 = row[7]
			#set $col9 = row[8]
			python -m subhkl.io.parser preparer "$col1 out/$col1.csv $col2 $col3 $col4 --image-orientation $col5 --scale-x $col6 --scale-y $col7 --nx $col8 --ny $col9" ; 
		#end for

		
    ]]></command>
    <inputs>
    
		<param format="csv" multiple="true" name="input" type="data" label="Peak data file" />
		<param format="csv" name="manifest" type="data" label="Manifest file" help="CSV file with one header row and columns in the following order: input file name without file extension, instrument shape(string in subhkl defined format), height, distance, orientation, scale x, scale y, nx, ny" />
		
    </inputs>
    <outputs>
		<collection name="output_data" type="list" label="Output Data">
		    <discover_datasets pattern="__designation__" ext="csv" directory="out/" />
		</collection>
    </outputs>
    <help><![CDATA[
        Calculates peak indices.
    ]]></help>
</tool>
