<tool id="neutrons_mcu_sample_simulator" name="Sample Simulator" profile="22.05" version="0.1.1">
    <description></description>
    <creator>
        <person name="Garrett Granroth"/>
        <organization url="https://www.ornl.gov/" name="ORNL"/>
    </creator>
    <requirements>
        <container type="docker">
            savannah.ornl.gov/ndip/tool-sources/direct-geometry-spectroscopy/mcu/sample-simulator/release/sample-simulator-mcvine:v0.3.0
        </container>
    </requirements>
    <inputs>
        <param name="instrument_name" type="select" label="Instrument Name">
            <option value="NOMAD" selected="false">NOMAD</option>
            <option value="SNAP" selected="false">SNAP</option>
        </param>
        <param name="incident_beam" type="data" label="Incident Beam MCPL File"/>
        <param name="sample_assembly" type="data" format="gz,zip" label="Sample assembly GZIP / ZIP"/>
        <param name="number_of_neutrons" type="integer" label="Number of Neutron Events" value="100000"/>
        <param name="multi_scat_flag" type="boolean" checked="false" label="Multiple Scattering" />
        <param name="number_of_nodes" type="integer" label="Number of Compute Nodes" value="1"/>
    </inputs>
    <command detect_errors="exit_code"><![CDATA[
        mkdir ./output/ &&
        mkdir ./sampleassembly/ && tar xf $sample_assembly -C sampleassembly --strip-components 1 &&

        python -m mcu_sample_simulator.main
          $instrument_name
          $incident_beam
          ./sampleassembly/
          --simulation-directory ./output
          --number-of-neutrons $number_of_neutrons
          --number-of-nodes    $number_of_nodes
          --overwrite-datafiles
        #if $multi_scat_flag:
          --multiple-scattering
        #end if
        &&
        echo "=== DEBUG ===" &&
        pwd &&
        echo "===" &&
        ls  &&
        echo "===" &&
        ls ./output &&
        ls ./output/rank0-step0/ &&
        echo "=== DEBUG ==="
    ]]></command>
    <outputs>
        <collection type="list" name="output_files" label="McVine output files">
            <discover_datasets format="binary" pattern="__designation__" directory="./output/rank0-step0"/>
        </collection>
    </outputs>

    <help><![CDATA[
        Runs McVine simulations of a sample.
    ]]></help>
</tool>
