<tool id="neutrons-sunny-sample-gen" name="Sunny Sample Generator" version="0.1.1" profile="22.01">
    <description>Sunny Tool</description>
    <requirements>
        <container type="docker" shell="/bin/bash">savannah.ornl.gov/ndip/tool-sources/chemical-spectroscopy/sunny:0.1.0</container>
    </requirements>
     <command><![CDATA[
        export out_folder=\$(cat $output_folder) &&
        mkdir -p \$out_folder &&
        export out_folder=\$(realpath \$out_folder) &&
        #if not $varExists('__job_resource.__job_resource__select') or $__job_resource.__job_resource__select=='no' or not $varExists('__job_resource.remote_resource_cloud_nersc') or $__job_resource.remote_resource_cloud_nersc=='orc' :
            pixi run --as-is --manifest-path /app app --nproc 4 --data-dir \$out_folder --nsamps $nsampl > >(tee -a $output) 2> >(tee -a $output >&2) &&
        #else
           module load julia/1.12.1 &&
           export JULIA_DEPOT_PATH=/global/cfs/cdirs/m1503/maiqmag/julia_depot &&
           julia --project=/global/cfs/cdirs/m1503/maiqmag/sunny /global/cfs/cdirs/m1503/maiqmag/sunny/src/sunny/sunny.jl --data-dir \$out_folder --nsamps $nsampl > >(tee -a $output) 2> >(tee -a $output >&2) &&
        #end if
        mkdir outputs &&
        ln -s \$out_folder/* outputs
    ]]></command>
    <inputs>
        <param name="experiment" type="text" label="Experiment Name"/>
        <param name="output_folder" type="data" label="Output Path"/>

        <param name="script" type="data" label="Sunny Script"/>
        <param name="method" type="select" label="Sampling Method" optional="false">
            <option value="uniform" selected="true">Uniform</option>
            <option value="gaussian" selected="true">Gaussian</option>
        </param>
        <param name="params" type="text" label="Sampling Parameters" value="[[a1,a2],[b1,b2],[c1,c2],[d1,d2]]"/>
        <param name="nsampl" type="integer" label="Number of Samples" value="1000"/>
    </inputs>
    <outputs>
        <data format="txt" name="output" label="SampleGen console output"></data>
        <collection type="list" name="output_collection" label="SampleGen results">
            <discover_datasets pattern="__designation_and_ext__" directory="outputs"/>
        </collection>
    </outputs>
    <help><![CDATA[
        **Sunny**

        This is a Galaxy tool for Sunny Sample Generator.

        For more information, see the repository: https://code.ornl.gov/ndip/tool-sources/spectroscopy/sunny
    ]]></help>
</tool>
