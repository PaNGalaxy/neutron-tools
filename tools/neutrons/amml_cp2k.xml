<tool id="neutrons_amml_cp2k" name="CP2K simulation"  profile="22.05" version="0.2.0">
  <description></description>
    <requirements>
        <container shell="/bin/bash" type="docker">cp2k/cp2k:2023.1</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        ln -s $xyz mof.xyz &&
        #set $nthreads = int($expert.threads or 0)
        #if $nthreads >0
          export OMP_NUM_THREADS=$nthreads &&
        #else
          NPROC=`nproc --all` &&
          NPROC=\$(( NPROC < 64 ? NPROC : 64 )) &&
          export OMP_NUM_THREADS=\$NPROC &&
        #end if
        cp2k -i $input &&
        mv mof_force.xyz $mof_force &&
        mv mof_pos.xyz $mof_pos
    ]]></command>
    <inputs>
        <param name="input" type="data" format="txt" optional="false" label="*.inp file"
               help="Must have 'TRAJECTORY ON' and 'FORCES ON' for subsequent DeePMD training"/>
        <param name="xyz" type="data" format="txt" optional="false" label="*.xyz file"/>
            <help>
            Run  DFT molecular dynamics (MD) with CP2K. Must have "TRAJECTORY ON" and "FORCES ON" for subsequent DeePMD training. Atomic coordinates and forces along the MD trajectory should be saved in xyz format.
        </help>
        <section name="expert" title="Expert Parameters">
        <param name="threads" type="integer" optional="true" max="64" label="Number of Threads" help="By default will use all threads available"/>
        </section>
    </inputs>
    <outputs>
        <data format="txt" name="mof_force" label="force file"/>
        <data format="txt" name="mof_pos" label="position file"/>
    </outputs>
    <help>
        Runs  DFT molecular dynamics (MD) with CP2K. Returns atomic coordinates and forces along the MD trajectory saved in xyz format.
    </help>
</tool>

