<tool id="nomad_NDIP_mcstas" name="NOMAD NDIP Instrument" version="1.0.0">
    <description>Run McStas simulation using NOMAD_NDIP instrument</description>
    <creator>
        <person name="Fahima Islam"/>
        <organization url="https://www.ornl.gov/" name="ORNL"/>
    </creator>

    <requirements>
        <container type="docker">mccode/mcstas-3.4:latest</container>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        ln -s $instrument_code $instrument_code.name &&
        ln -s $spectrum_file $spectrum_file.name && 
        mcrun $instrument_code -d
          s3l=$s3l s3r=$s3r s3t=$s3t s3b=$s3b
          s4l=$s4l s4r=$s4r s4t=$s4t s4b=$s4b
          --ncount=$ncount --dir=outputs &&
        (mv outputs/*.mcpl.gz $out_mcpl || true)
    ]]></command>

    <inputs>
        <param name="instrument_code" type="data" format="txt" label="Instrument Source (.instr)" optional="false"/>
        <param name="spectrum_file" type="data" format="txt" label="Source Spectrum (.dat)" optional="false"/>
        <param name="s3l" type="float" value="1.1" label="s3 left"/>
        <param name="s3r" type="float" value="1.1" label="s3 right"/>
        <param name="s3t" type="float" value="1.1" label="s3 top"/>
        <param name="s3b" type="float" value="1.1" label="s3 bottom"/>
        <param name="s4l" type="float" value="1.1" label="s4 left"/>
        <param name="s4r" type="float" value="1.1" label="s4 right"/>
        <param name="s4t" type="float" value="1.1" label="s4 top"/>
        <param name="s4b" type="float" value="1.1" label="s4 bottom"/>
        <param name="ncount" type="text" value="1e7" label="Number of particles"/>
    </inputs>

    <outputs>
        <data format="gz" name="out_mcpl" label="MCPL Output File"/>
    </outputs>

    <help><![CDATA[
        This tool runs a McStas simulation using the NOMAD_NDIP instrument.

        Required Inputs:
        - Instrument file (.instr)
        - Source spectrum file (.dat)

        You can control the slit parameters s3 and s4, as well as number of neutrons.

        Output:
        - MCPL file (if generated by instrument)
    ]]></help>
</tool>
