<tool id="imaginex_image_generator" name="IMAGINE-X image generator"  profile="22.05" version="0.1.0-dev" python_template_version="3.5">
    <requirements>
      <container type="docker">code.ornl.gov:4567/dnp-computational-project/instrument/brave-image-generator</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #if $params.usefilepath == 'true':
            ln -sf '$params.filepath' $output
        #else:
            python3 /app/import_oncat.py
            --facility $params.facility
            --instrument $params.instrument
            --ipts $params.ipts
            --run $params.run
            --oncat-url https://oncat.ornl.gov
            --output $output
        #end if
    ]]></command>
    <inputs>
        <conditional name="params">
            <param name="usefilepath" type="boolean" truevalue="true" falsevalue="false" checked="no"
                   label="Use filepath" help=""/>
            <when value="true">
        		<param name="filepath" type="text" label="Filesystem path" optional="false"/>
            </when>
            <when value="false">
                <param name="facility" type="select" label="Facility Name" optional="false">
                    <option value="SNS" selected="true">SNS</option>
                    <option value="HFIR">HFIR</option>
                </param>
                <param name="instrument" type="select" label="Instrument Name" optional="false">
                    <options from_data_table="instruments">
                        <column name="name" index="3"/>
                        <column name="value" index="2"/>
                        <filter type="param_value" ref="facility" column="0"/>
                    </options>
                </param>
                <param name="ipts" type="text" label="IPTS Number" value="0" optional="false"/>
                <param name="run" type="integer" label="Run Number" value="0" optional="false"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format="h5" name="output" label="#if $params.usefilepath then $params.filepath else str($params.facility)+'-'+str($params.instrument)+'-'+str($params.ipts)+'-'+str($params.run)+' data' #">
        </data>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
<!--  <requirements>
    <container type="docker">code.ornl.gov:4567/dnp-computational-project/instrument/brave-image-generator</container>
  </requirements>
    <command detect_errors="exit_code"><![CDATA[
        mkdir data ;
        cp $input ./data/input.nxs.h5
        
	    ## Run the docker container
	    
	    #if $parameterTime.useTime == True
	    	#set $timeOption = "-#-time $parameterTime.time"
	    #else
	        #set $timeOption = ""
	    #end if
	    
	    bash -c 'docker run -#-rm -#-init -v \$(pwd)/data:/data imaginex-image-generator -#-input_file /data/input.nxs.h5 -#-output_dir /data/out $timeOption -#-wavelength_max $wavelengthMax -#-wavelength_min $wavelengthMin' ;

    ]]></command>
    <inputs>
    
        <param name="input" type="data" format="h5" label="Input File">
	    </param>
	    <param name="wavelengthMin" type="float" value="1.0" label="Max Wavelength"> 
		</param>
		<param name="wavelengthMax" type="float" value="3.5" label="Max Wavelength"> 
		</param>
	    <conditional name="parameterTime">
		    <param name="useTime" type="boolean" checked="false" label="Use Time" help="Whether to use a time value."> 
		    </param>
		    <when value="true">
		        <param name="time" type="float" value="90.0" label="Time"> 
		        </param>
	    	</when>
    	</conditional>

    </inputs>
    <outputs>
	<collection name="output_files" type="list" label="Output Images">
	    <discover_datasets pattern="(?P&lt;designation&gt;.*)\.(?P&lt;ext&gt;[^\._]+)$" directory="data/out" />
	</collection>
    </outputs>
    <help><![CDATA[
        Iage generation for IMAGINE-X beamline data reduction.
    ]]></help>
</tool>-->
