<tool id="neutrons_mlsans_fit_lamellar" name="fit_lamellar_IQ"  profile="20.04" version="0.1.6-dev4">
  <description></description>
    <requirements>
        <container type="docker">code.ornl.gov:4567/ndip/tool-sources/ml-assisted-sans-data-analysis/fit-lamellar:0.1.6-dev</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python3 /src/curvefit.py -i $input $sigma_k $kappa $alpha $y_scale $x_scale $bg || echo python finished && mv output.png $output && cp output.txt $output2 && mv output3.png $output3
    ]]></command>
    <inputs>
        <param name="input" type="data" optional="false" label="ASCII data"/>
        <param name="sigma_k" type="text" value="0.72 0.5 1.0" label="σ_k" optional="false" help="Dispersion of wave vector magnityde"/>
        <param name="kappa" type="text" value="5 4 12" label="Γ" optional="false" help="Anisotropy"/>
        <param name="alpha" type="text" value="0.7 0.5 1.0" label="α" optional="false" help="Clipping level"/>
        <param name="y_scale" type="text" value="6.3e5 1e5 1e6" label="y_scale" optional="false" help="Contrast"/>
        <param name="x_scale" type="text" value="1.05 0.9 1.1" label="x_scale" optional="false" help="Interplanar distance"/>
        <param name="bg" type="text" value="0.19 0.1 0.2" label="bg" optional="false" help="Incoherent background"/>
    </inputs>
	
    <outputs>
        <data name="output" format="png" label="fitting results plot">
        </data>
        <data name="output2" format="txt" label="fitting results">
        </data>
        <data name="output3" format="png" label="real space structure">
        </data>
    </outputs>

    <tests>
        <test>
            <param name="input" value="./test-data/example_IQ_lamellar.csv"/>
            <param name="sigma_k" value="0.72 0.5 1.0"/>
            <param name="kappa" value="5 4 12"/>
            <param name="alpha" value="0.7 0.5 1.0"/>
            <param name="y_scale" value="6.3e5 1e5 1e6"/>
            <param name="x_scale" value="1.05 0.9 1.1"/>
            <param name="bg" value="0.19 0.1 0.2"/>

            <output name="output2" file="output.txt"/>
        </test>
    </tests>

    <help><![CDATA[
        **What it does**
        Fit the input L_α lyotropic phase (lamellar) I(Q) curve. 
        
        **Usage**
        Initial guess, lower bound and upper bound are separated using spaces. 
        The input Q points should be rescaled by interplanar distance such that QD/2pi = (1:126)*0.05.
]]></help>
    <citations>
    <!-- Example of annotating a citation using a DOI. -->
        <citation type="doi">10.1016/j.jcis.2024.01.003</citation>
        <citation type="doi">10.1021/acs.macromol.4c00821</citation>
    </citations>

</tool>

 