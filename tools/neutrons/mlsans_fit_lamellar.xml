<tool id="neutrons_mlsans_fit_lamellar" name="fit_IQ"  profile="20.04" version="0.0.1-dev">
  <description></description>
    <requirements>
        <container type="docker">savannah.ornl.gov/ndip/tool-sources/ml-assisted-sans-data-analysis/fit-lamellar@sha256:a54deb9036fe63c441dfb62d8e6ad504c102528609609f5c7f6f874ffe59cf47</container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python3 /src/curvefit.py -i $input $sigma_k $kappa $alpha $y_scale $x_scale $bg || echo python finished && mv output.png $output && cp /src/output.txt $output2
    ]]></command>
    <inputs>
        <param name="input" type="data" optional="false" label="ASCII data"/>
        <param name="sigma_k" type="text" value="0.72 0.5 1.0" label="σ_k" optional="false" help="Dispersion of wave vector magnityde"/>
        <param name="kappa" type="text" value="5 4 12" label="Γ" optional="false" help="Anisotropy"/>
        <param name="alpha" type="text" value="0.7 0.5 1.0" label="α" optional="false" help="Clipping level"/>
        <param name="y_scale" type="text" value="6.3e5 1e5 1e6" label="y_scale" optional="false" help="Contrast"/>
        <param name="x_scale" type="text" value="1.05 0.9 1.1" label="x_scale" optional="false" help="Interplanar distance"/>
        <param name="bg" type="text" value="0.19 0.1 0.2" label="bg" optional="false" help="Incoherent background"/>
    </inputs>
	
    <outputs>
        <data name="output" format="png" label="fitting results plot">
        </data>
        <data name="output2" format="txt" label="fitting results">
        </data>
    </outputs>
    <help><![CDATA[
        Fit the input I(Q) curve. Initial guess, lower bound and upper bound are separated using spaces.
]]></help>
    <tests>
        <test>
            <inputs>
                <param name="input" type="data" value="/src/example_IQ.csv" optional="false" label="ASCII data"/>
                <param name="sigma_k" type="text" value="0.72 0.5 1.0" label="σ_k" optional="false" help="Dispersion of wave vector magnityde"/>
                <param name="kappa" type="text" value="5 4 12" label="Γ" optional="false" help="Anisotropy"/>
                <param name="alpha" type="text" value="0.7 0.5 1.0" label="α" optional="false" help="Clipping level"/>
                <param name="y_scale" type="text" value="6.3e5 1e5 1e6" label="y_scale" optional="false" help="Contrast"/>
                <param name="x_scale" type="text" value="1.05 0.9 1.1" label="x_scale" optional="false" help="Interplanar distance"/>
                <param name="bg" type="text" value="0.19 0.1 0.2" label="bg" optional="false" help="Incoherent background"/>
            </inputs>
            
            <outputs>
                <data name="output" format="png" label="fitting results plot">
                </data>
                <data name="output2" format="txt" label="fitting results">
                </data>
            </outputs>
        </test>
    </tests>

</tool>

