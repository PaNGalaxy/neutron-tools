<tool id="nexus_processor_prototype" name="Nexus Processor" version="0.1.0" profile="22.01">
    <description>Nexus Processor CLI Tool</description>
    <creator>
        <person name="Marshall McDonnell"/>
        <organization url="https://www.ornl.gov/" name="ORNL"/>
    </creator>

    <requirements>
        <container type="docker" shell="/bin/bash">ghcr.io/neutrons-ai/nexus-processor:latest</container>
    </requirements>

    <inputs>
        <param name="input_file" type="data" format="h5" label="Input NeXus File"/>
        <param name="include_events" type="boolean" label="Include Events"/>
        <param name="include_users" type="boolean" label="Include Users"/>
        <param name="max_events" type="integer" optional="true" label="Max Events"/>
        <param name="max_events_per_file" type="integer" value="10000000" label="Max Events Per File"/>
    </inputs>

    <outputs>
        <data name="parquet_output" format="directory" label="Parquet Output Directory"/>
    </outputs>

    <command detect_errors="exit_code"><![CDATA[
        mkdir -p output &&
        ln -s $input_file ./input.nxs.h5 &&
        nexus_processor \
            --input_file ./input.nxs.h5 \
            --output-dir output/ \
            #if $include_events
              --include-events ${include_events:-false} \
            #end if
            #if $include_users
              --include-users ${include_users:-false} \
            #end if
            #if $max_events
            --max-events $max_events \
            #end if
            --max-events-per-file ${max_events_per_file} \
            && mv output/* $parquet_output
    ]]></command>
</tool>