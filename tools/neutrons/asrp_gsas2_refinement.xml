<tool id="neutrons_asrp_gsas2_new" name="GSAS2 Refinement" profile="22.05" version="0.8.0">
    <description></description>
    <creator>
        <person name="Marshall McDonnell"/>
        <organization url="https://www.ornl.gov/" name="ORNL"/>
    </creator>
    <requirements>
        <container type="docker" shell="/bin/bash">
            savannah.ornl.gov/asrp/gsas2_refinement:0.7
        </container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        cd /app &&
        touch $output &&
        #set gsas_filename=os.path.basename(str($gsas_file.element_identifier))
        ln -s $gsas_file /app/$gsas_filename &&
        ln -s $prm_file /app/input.instprm &&
        ln -s $cif_file /app/input.cif &&
        python -m gsas2_refinement.gsas2_refinement
                --cif-filename /app/input.cif
                --gsas-filename /app/$gsas_filename
                --instrument-params-filename /app/input.instprm
                --scatter-type $scatter_type
                --bank-id $bank_id
                --xmin $xmin
                --xmax $xmax
                --output-directory ./portal
                > >(tee -a $output) 2> >(tee -a $output >&2)
        &&
        mv ./portal ./output-gsas2 > >(tee -a $output) 2> >(tee -a $output >&2)
        && 
        tar -cvzf output-gsas2.tgz ./output-gsas2 > >(tee -a $output) 2> >(tee -a $output >&2)
        &&
        ls -lath ./output-gsas2 > >(tee -a $output) 2> >(tee -a $output >&2)
        &&
        ls -lath ./ > >(tee -a $output) 2> >(tee -a $output >&2)
    ]]></command>
    <inputs>
        <param name="cif_file" type="data" format="txt" label="CIF File"/>
        <param name="gsas_file" type="data" format="txt" label="GSAS File"/>
        <param name="prm_file" type="data" format="txt" label="Instrument Parameter File"/>

        <param name="scatter_type" type="select" label="Scatter Type" optional="false">
            <option value="N" selected="false">Neutron</option>
            <option value="X" selected="false">X-ray</option>
        </param>
        <param name="bank_id" type="integer" label="Bank ID" value="0"/>
        <param name="xmin" type="float" label="Left bound" value="0"/>
        <param name="xmax" type="float" label="Right bound" value="0"/>
    </inputs>
    <outputs>
        <data format="tgz" name="output_gsas2" from_work_dir="./output-gsas2.tgz" />
        <data format="txt" name="output" label="GSAS2 console output"></data>
    </outputs>
    <help><![CDATA[
        Runs GSAS2 Rietveld refinement.
    ]]></help>
</tool>
